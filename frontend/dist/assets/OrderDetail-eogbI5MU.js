import{g as B,d as D,b as E,a as F,k as I,r as m,f as p,j as e,L as H}from"./index-BxsvggaG.js";import{H as _}from"./Header-DUNe79n9.js";import{a as w}from"./Skeleton-BiEkAveh.js";const U={pending_payment:"bg-yellow-100 text-yellow-700 border-yellow-200",awaiting_approval:"bg-blue-100 text-blue-700 border-blue-200",approved:"bg-green-100 text-green-700 border-green-200",rejected:"bg-red-100 text-red-700 border-red-200",completed:"bg-gray-100 text-gray-700 border-gray-200",cancelled:"bg-gray-100 text-gray-500 border-gray-200"},k={pending_payment:"Pending Payment",awaiting_approval:"Awaiting Seller Approval",approved:"Approved - Ready for Pickup",rejected:"Payment Rejected",completed:"Completed",cancelled:"Cancelled"};function T(){var g,j,f,N,v;const{id:l}=B(),S=D(),{user:o}=E(),{addToast:r}=F(),{socket:i,connectSocket:b}=I(),[P,O]=m.useState(!0),[d,n]=m.useState(!1),[s,h]=m.useState(null);m.useEffect(()=>{i||b()},[i,b]),m.useEffect(()=>{if(!i||!l)return;const a=t=>{t.order_id===parseInt(l)&&(h(t.order),r({type:t.status==="approved"?"success":t.status==="rejected"?"error":"info",message:`Order status updated: ${k[t.status]||t.status}`}))};return i.on("order_status_update",a),()=>{i.off("order_status_update",a)}},[i,l,r]),m.useEffect(()=>{x()},[l]);const x=async()=>{try{const a=await p.get(`/api/v1/orders/${l}`);h(a.data.order)}catch{r({type:"error",message:"Failed to load order"}),S("/orders")}finally{O(!1)}},A=async()=>{var a,t;n(!0);try{await p.post(`/api/v1/orders/${l}/confirm-payment`),r({type:"success",message:"Payment confirmation sent to seller!"}),x()}catch(c){r({type:"error",message:((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to confirm payment"})}finally{n(!1)}},C=async()=>{var a,t;n(!0);try{await p.post(`/api/v1/orders/${l}/approve`),r({type:"success",message:"Order approved! Stock updated."}),x()}catch(c){r({type:"error",message:((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to approve order"})}finally{n(!1)}},R=async()=>{var t,c;const a=prompt("Reason for rejection (optional):");n(!0);try{await p.post(`/api/v1/orders/${l}/reject`,{reason:a}),r({type:"info",message:"Order rejected"}),x()}catch($){r({type:"error",message:((c=(t=$.response)==null?void 0:t.data)==null?void 0:c.message)||"Failed to reject order"})}finally{n(!1)}},L=async()=>{var a,t;n(!0);try{await p.post(`/api/v1/orders/${l}/complete`),r({type:"success",message:"Order completed! Please leave a review."}),x()}catch(c){r({type:"error",message:((t=(a=c.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to complete order"})}finally{n(!1)}};if(P)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(_,{title:"Order Details",showBack:!0}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(w,{className:"h-32 rounded-2xl"}),e.jsx(w,{className:"h-48 rounded-2xl"})]})]});if(!s)return null;const u=(o==null?void 0:o.id)===s.buyer_id,y=(o==null?void 0:o.id)===((g=s.store)==null?void 0:g.owner_id);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(_,{title:"Order Details",showBack:!0}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx("div",{className:`card border-2 ${U[s.status]}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm opacity-75",children:"Status"}),e.jsx("p",{className:"text-lg font-bold",children:k[s.status]})]}),e.jsxs("span",{className:"text-4xl",children:[s.status==="pending_payment"&&"‚è≥",s.status==="awaiting_approval"&&"üîç",s.status==="approved"&&"‚úÖ",s.status==="rejected"&&"‚ùå",s.status==="completed"&&"üéâ"]})]})}),e.jsxs("div",{className:"card",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Order Number"}),e.jsxs("p",{className:"text-xl font-mono font-bold text-gray-900",children:["#",s.order_number]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Product"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl bg-gray-100 overflow-hidden flex-shrink-0",children:(N=(f=(j=s.product)==null?void 0:j.media)==null?void 0:f[0])!=null&&N.url?e.jsx("img",{src:s.product.media[0].url,alt:s.product.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-3xl",children:"üì¶"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:(v=s.product)==null?void 0:v.title}),e.jsxs("p",{className:"text-sm text-gray-500",children:["‚Ç¶",s.unit_price.toLocaleString()," √ó ",s.quantity]}),e.jsxs("p",{className:"text-lg font-bold text-primary-600 mt-1",children:["‚Ç¶",s.total_price.toLocaleString()]})]})]})]}),y&&s.buyer&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Buyer Information"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("p",{className:"text-gray-900",children:[s.buyer.first_name," ",s.buyer.last_name]}),e.jsx("p",{className:"text-sm text-gray-500",children:s.buyer.email}),s.buyer_note&&e.jsxs("div",{className:"mt-3 p-3 bg-gray-50 rounded-lg",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-1",children:"Buyer Note:"}),e.jsx("p",{className:"text-sm text-gray-700",children:s.buyer_note})]})]})]}),u&&s.store&&e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Seller Information"}),e.jsxs(H,{to:`/store/${s.store.id}`,className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl hover:bg-gray-100",children:[e.jsx("span",{className:"text-2xl",children:"üè™"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-900",children:s.store.name}),e.jsx("p",{className:"text-sm text-gray-500",children:"View Store ‚Üí"})]})]})]}),u&&s.status==="pending_payment"&&s.bank_details&&e.jsxs("div",{className:"card bg-blue-50 border-2 border-blue-200",children:[e.jsx("h2",{className:"font-semibold text-blue-900 mb-3",children:"üí≥ Payment Details"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Bank Name"}),e.jsx("p",{className:"font-medium text-blue-900",children:s.bank_details.bank_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Account Number"}),e.jsx("p",{className:"font-mono font-medium text-blue-900",children:s.bank_details.account_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Account Name"}),e.jsx("p",{className:"font-medium text-blue-900",children:s.bank_details.account_name})]}),e.jsxs("div",{className:"pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Amount to Pay"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["‚Ç¶",s.total_price.toLocaleString()]})]})]})]}),s.status==="rejected"&&s.seller_note&&e.jsxs("div",{className:"card bg-red-50 border-2 border-red-200",children:[e.jsx("h3",{className:"font-semibold text-red-900 mb-2",children:"Rejection Reason"}),e.jsx("p",{className:"text-sm text-red-800",children:s.seller_note})]})]}),e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-4 py-3 z-20",children:[u&&s.status==="pending_payment"&&e.jsx("button",{onClick:A,disabled:d,className:"btn-primary w-full",children:d?"Sending...":"I've Paid - Notify Seller"}),u&&s.status==="approved"&&e.jsx("button",{onClick:L,disabled:d,className:"btn-primary w-full",children:d?"Processing...":"Mark as Received"}),y&&s.status==="awaiting_approval"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:R,disabled:d,className:"btn-secondary flex-1",children:"Reject"}),e.jsx("button",{onClick:C,disabled:d,className:"btn-primary flex-1",children:d?"Approving...":"Approve Payment"})]})]})]})}export{T as default};
