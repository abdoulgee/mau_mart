import{d as q,h as F,b as T,a as W,r as a,f as i,j as e}from"./index-BxsvggaG.js";import{H as L}from"./Header-DUNe79n9.js";import{a as _}from"./Skeleton-BiEkAveh.js";function D(){var p,f,b,j,y,g,N;const l=q(),[d]=F(),{user:$}=T(),{addToast:c}=W(),[C,A]=a.useState(!0),[m,x]=a.useState(!1),[s,B]=a.useState(null),[n,I]=a.useState(parseInt(d.get("qty"))||1),[u,M]=a.useState("");a.useEffect(()=>{const t=d.get("product");if(!t){l("/");return}H(t)},[]);const H=async t=>{try{const r=await i.get(`/api/v1/products/${t}`);B(r.data.product)}catch{c({type:"error",message:"Failed to load product"}),l("/")}finally{A(!1)}},R=async()=>{var t,r,v,w;if(!((t=s.store)!=null&&t.bank_name)||!((r=s.store)!=null&&r.account_number)){c({type:"error",message:"Seller has not set up payment details yet. Please contact them."});return}x(!0);try{const S=(await i.post("/api/v1/orders",{product_id:s.id,quantity:n,buyer_note:u})).data.order,P=await i.post(`/api/v1/orders/${S.id}/confirm-payment`);c({type:"success",message:"Payment confirmation sent to seller!"}),P.data.chat_id?l(`/chat/${P.data.chat_id}`):l(`/order/${S.id}`)}catch(k){c({type:"error",message:((w=(v=k.response)==null?void 0:v.data)==null?void 0:w.message)||"Failed to process order"})}finally{x(!1)}};if(C)return e.jsxs("div",{className:"min-h-screen bg-surface-50",children:[e.jsx(L,{title:"Checkout",showBack:!0}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(_,{className:"h-32 rounded-2xl"}),e.jsx(_,{className:"h-48 rounded-2xl"})]})]});if(!s)return null;const o=parseFloat(s.price)*n,h=((p=s.store)==null?void 0:p.bank_name)&&((f=s.store)==null?void 0:f.account_number);return e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-24",children:[e.jsx(L,{title:"Checkout",showBack:!0}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Order Summary"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-20 h-20 rounded-xl bg-surface-100 overflow-hidden flex-shrink-0",children:(j=(b=s.media)==null?void 0:b[0])!=null&&j.url?e.jsx("img",{src:s.media[0].url,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-1",children:s.title}),e.jsxs("p",{className:"text-sm text-gray-500 mb-2",children:["‚Ç¶",s.price.toLocaleString()," each"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{className:"text-sm text-gray-600",children:"Quantity:"}),e.jsx("input",{type:"number",min:"1",max:s.stock_quantity,value:n,onChange:t=>I(Math.max(1,Math.min(s.stock_quantity,parseInt(t.target.value)||1))),className:"w-20 px-2 py-1.5 border border-surface-200 rounded-xl text-center focus:outline-none focus:ring-2 focus:ring-primary-400/30 font-medium"})]})]})]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-surface-200 flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-gray-900",children:"Total Amount"}),e.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:["‚Ç¶",o.toLocaleString()]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{className:"font-semibold text-gray-900 mb-3",children:"Seller Information"}),e.jsx("div",{className:"space-y-2",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-xl flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-primary-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.8,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:(y=s.store)==null?void 0:y.name}),e.jsx("p",{className:"text-sm text-gray-500",children:e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("svg",{className:"w-3 h-3 text-primary-400",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"})}),((N=(g=s.store)==null?void 0:g.rating)==null?void 0:N.toFixed(1))||"0.0"]})})]})]})})]}),e.jsxs("div",{className:"card",children:[e.jsxs("h2",{className:"font-bold text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5 text-primary-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.8,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"Payment Details"]}),h?e.jsxs("div",{className:"space-y-3 bg-primary-50 p-4 rounded-2xl border-2 border-primary-200",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Bank Name"}),e.jsx("p",{className:"font-medium text-blue-900",children:s.store.bank_name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Account Number"}),e.jsx("p",{className:"font-mono font-medium text-lg text-blue-900",children:s.store.account_number})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Account Name"}),e.jsx("p",{className:"font-medium text-blue-900",children:s.store.account_name})]}),e.jsxs("div",{className:"pt-3 border-t border-blue-200",children:[e.jsx("p",{className:"text-xs text-blue-600 mb-1",children:"Amount to Transfer"}),e.jsxs("p",{className:"text-2xl font-bold text-blue-900",children:["‚Ç¶",o.toLocaleString()]})]})]}):e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:e.jsx("p",{className:"text-sm text-yellow-800",children:"‚ö†Ô∏è Seller has not set up payment details yet. Please contact them before ordering."})})]}),e.jsxs("div",{className:"card",children:[e.jsx("label",{className:"label",children:"Note to Seller (Optional)"}),e.jsx("textarea",{value:u,onChange:t=>M(t.target.value),placeholder:"Add any special instructions...",rows:3,className:"input"})]}),e.jsxs("div",{className:"card bg-amber-50 border-amber-200",children:[e.jsx("h3",{className:"font-semibold text-amber-900 mb-2",children:"üìù How to Complete Your Purchase"}),e.jsxs("ol",{className:"text-sm text-amber-800 space-y-1 list-decimal list-inside",children:[e.jsxs("li",{className:"font-medium",children:["Transfer ‚Ç¶",o.toLocaleString()," to the account above"]}),e.jsx("li",{children:`After transferring, click "I've Paid" button below`}),e.jsx("li",{children:"A receipt will be sent to the seller automatically"}),e.jsx("li",{children:"Wait for seller to approve your payment"}),e.jsx("li",{children:"Arrange pickup with seller via chat"})]})]})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 glass border-t border-surface-200/60 px-4 py-3 z-50 safe-bottom",children:e.jsx("button",{onClick:R,disabled:m||!h,className:"w-full px-4 py-3.5 bg-gradient-to-r from-emerald-500 to-emerald-600 text-white font-bold rounded-2xl hover:from-emerald-600 hover:to-emerald-700 disabled:opacity-50 disabled:cursor-not-allowed shadow-lg text-sm tracking-wide",children:m?"Processing...":"I've Paid - Send Receipt to Seller"})})]})}export{D as default};
