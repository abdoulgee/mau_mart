import{g as E,d as F,a as L,u as T,r as l,f as u,j as e}from"./index-BxsvggaG.js";function A(){const{id:d}=E(),x=F(),{addToast:n}=L(),{categories:j,fetchCategories:v,connectSocket:N}=T(),[g,h]=l.useState(!1),[_,k]=l.useState([]),[y,b]=l.useState([]),[i,p]=l.useState({title:"",description:"",price:"",compare_price:"",product_type:"physical",stock_quantity:1,pickup_location:"",category_ids:[]}),m=!!d;l.useEffect(()=>{N(),v(),m&&C()},[d]);const C=async()=>{var s;try{const t=(await u.get(`/api/v1/products/${d}`)).data.product;p({title:t.title||"",description:t.description||"",price:t.price||"",compare_price:t.compare_price||"",product_type:t.product_type||"physical",stock_quantity:t.stock_quantity||1,pickup_location:t.pickup_location||"",category_ids:((s=t.categories)==null?void 0:s.map(r=>r.id))||[]}),t.media&&b(t.media.map(r=>r.url))}catch{n({type:"error",message:"Failed to load product"}),x("/seller/products")}},c=s=>{const{name:a,value:t,type:r}=s.target;p(o=>({...o,[a]:r==="number"?parseFloat(t)||"":t}))},w=s=>{p(a=>({...a,category_ids:a.category_ids.includes(s)?a.category_ids.filter(t=>t!==s):[...a.category_ids,s]}))},P=s=>{const a=Array.from(s.target.files).slice(0,4);k(a);const t=a.map(r=>URL.createObjectURL(r));b(t)},S=async s=>{var a,t;if(s.preventDefault(),!i.title||!i.price){n({type:"error",message:"Title and price are required"});return}h(!0);try{const r=new FormData;Object.entries(i).forEach(([o,f])=>{o==="category_ids"?f.forEach(q=>r.append("category_ids",q)):r.append(o,f)}),_.forEach(o=>{r.append("media",o)}),m?(await u.put(`/api/v1/products/${d}`,r,{headers:{"Content-Type":"multipart/form-data"}}),n({type:"success",message:"Product updated!"})):(await u.post("/api/v1/products",r,{headers:{"Content-Type":"multipart/form-data"}}),n({type:"success",message:"Product created!"})),x("/seller/products")}catch(r){n({type:"error",message:((t=(a=r.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to save product"})}finally{h(!1)}};return e.jsxs("div",{className:"p-4 pb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-6",children:m?"Edit Product":"Add Product"}),e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"card",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Product Images"}),e.jsxs("div",{className:"grid grid-cols-4 gap-2",children:[y.map((s,a)=>e.jsx("div",{className:"aspect-square rounded-xl bg-gray-100 overflow-hidden",children:e.jsx("img",{src:s,alt:"",className:"w-full h-full object-cover"})},a)),y.length<4&&e.jsxs("label",{className:"aspect-square rounded-xl border-2 border-dashed border-gray-300 flex flex-col items-center justify-center cursor-pointer hover:border-primary-500 transition-colors",children:[e.jsx("svg",{className:"w-6 h-6 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),e.jsx("span",{className:"text-xs text-gray-400 mt-1",children:"Add"}),e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:P,className:"hidden"})]})]})]}),e.jsxs("div",{className:"card space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Title *"}),e.jsx("input",{type:"text",name:"title",value:i.title,onChange:c,className:"input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:i.description,onChange:c,rows:4,className:"input resize-none"})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Pricing"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Price (₦) *"}),e.jsx("input",{type:"number",name:"price",value:i.price,onChange:c,className:"input",required:!0,min:"0",step:"0.01"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compare Price (₦)"}),e.jsx("input",{type:"number",name:"compare_price",value:i.compare_price,onChange:c,className:"input",min:"0",step:"0.01"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-3",children:"Inventory"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Stock Quantity"}),e.jsx("input",{type:"number",name:"stock_quantity",value:i.stock_quantity,onChange:c,className:"input",min:"0"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pickup Location"}),e.jsx("input",{type:"text",name:"pickup_location",value:i.pickup_location,onChange:c,placeholder:"e.g., Block A",className:"input"})]})]})]}),e.jsxs("div",{className:"card",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-3",children:"Categories"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(s=>e.jsx("button",{type:"button",onClick:()=>w(s.id),className:`px-3 py-1.5 rounded-full text-sm transition-colors ${i.category_ids.includes(s.id)?"bg-primary-500 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:s.name},s.id))})]}),e.jsx("button",{type:"submit",disabled:g,className:"btn-primary w-full disabled:opacity-50",children:g?"Saving...":m?"Update Product":"Create Product"})]})]})}export{A as default};
