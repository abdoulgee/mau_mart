import{k as p,b as j,h as v,d as N,r as o,j as e,L as g}from"./index-BxsvggaG.js";import{H as y}from"./Header-DUNe79n9.js";function b({chat:a}){var c;const{user:r}=j(),s=a.other_user,t=a.last_message;return e.jsxs(g,{to:`/chat/${a.id}`,className:"flex items-center gap-3 p-4 bg-white hover:bg-surface-50 transition-colors",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary-400 to-accent-500 flex items-center justify-center text-white font-medium",children:s!=null&&s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:"",className:"w-full h-full rounded-full object-cover"}):((c=s==null?void 0:s.first_name)==null?void 0:c[0])||"?"}),a.unread_count>0&&e.jsx("span",{className:"absolute -top-1 -right-1 w-5 h-5 bg-accent-500 text-white text-xs font-bold rounded-full flex items-center justify-center shadow-sm",children:a.unread_count>9?"9+":a.unread_count})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("h3",{className:`font-medium ${a.unread_count>0?"text-gray-900":"text-gray-700"}`,children:[s==null?void 0:s.first_name," ",s==null?void 0:s.last_name]}),e.jsx("span",{className:"text-xs text-gray-400",children:t&&w(t.created_at)})]}),e.jsxs("p",{className:`text-sm truncate ${a.unread_count>0?"text-gray-900 font-medium":"text-gray-500"}`,children:[(t==null?void 0:t.message_type)==="image"&&"ðŸ“· Photo",(t==null?void 0:t.message_type)==="order"&&"ðŸ“¦ Order message",(t==null?void 0:t.message_type)==="text"&&(t==null?void 0:t.content),!t&&"Start a conversation"]})]})]})}function w(a){const r=new Date(a),t=new Date-r;return t<6e4?"Now":t<36e5?`${Math.floor(t/6e4)}m`:t<864e5?`${Math.floor(t/36e5)}h`:t<6048e5?r.toLocaleDateString("en",{weekday:"short"}):r.toLocaleDateString("en",{month:"short",day:"numeric"})}function L(){const{conversations:a,fetchConversations:r,startChat:s,isLoadingConversations:t,connectSocket:c,socket:u}=p(),{isAuthenticated:n}=j(),[l]=v(),h=N(),[d,m]=o.useState(!1);return o.useEffect(()=>{n&&!u&&c()},[n,u,c]),o.useEffect(()=>{const i=l.get("seller"),f=l.get("product");i&&n&&!d&&(m(!0),s(parseInt(i),f?parseInt(f):null).then(x=>{x.success&&x.chat?h(`/chat/${x.chat.id}`,{replace:!0}):m(!1)}).catch(()=>{m(!1)}))},[l,n,s,h,d]),o.useEffect(()=>{n&&r()},[n,r]),n?d?e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-primary-400 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 font-medium text-sm",children:"Starting conversation..."})]})}):e.jsxs("div",{className:"min-h-screen bg-surface-50 pb-20",children:[e.jsx(y,{title:"Messages"}),t?e.jsx("div",{className:"space-y-px",children:[1,2,3,4].map(i=>e.jsxs("div",{className:"p-4 bg-white flex items-center gap-3",children:[e.jsx("div",{className:"skeleton w-12 h-12 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"skeleton h-4 w-32 mb-2"}),e.jsx("div",{className:"skeleton h-3 w-48"})]})]},i))}):a.length>0?e.jsx("div",{className:"divide-y divide-gray-100",children:a.map(i=>e.jsx(b,{chat:i},i.id))}):e.jsxs("div",{className:"text-center py-16 px-4",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-surface-100 rounded-2xl flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("h3",{className:"text-base font-bold text-gray-900 mb-2",children:"No messages yet"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Start chatting with sellers when you find products you like!"})]})]}):e.jsx("div",{className:"min-h-screen bg-surface-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-surface-100 rounded-2xl flex items-center justify-center",children:e.jsx("svg",{className:"w-10 h-10 text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-2",children:"Login Required"}),e.jsx("p",{className:"text-gray-500 mb-6 text-sm",children:"Please login to view your messages"}),e.jsx(g,{to:"/login",className:"btn-primary px-8",children:"Login"})]})})}export{L as default};
