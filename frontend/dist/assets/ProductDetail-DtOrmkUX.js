import{r as c,b as z,a as A,f as k,j as e,g as D,d as E,L as O}from"./index-BxsvggaG.js";import{H as q}from"./Header-DUNe79n9.js";import{u as I}from"./productStore-CZGEDRsy.js";import{a as x}from"./Skeleton-BiEkAveh.js";import{R as T}from"./ReportModal-DbEHjK7l.js";function U({productId:l,canReview:h=!1}){var w;const[o,R]=c.useState([]),[$,u]=c.useState(!0),[j,n]=c.useState(!1),[y,S]=c.useState(5),[v,M]=c.useState(""),[p,g]=c.useState(!1),[d,_]=c.useState({average:0,total:0,distribution:{}}),{isAuthenticated:P,user:f}=z(),{addToast:N}=A();c.useEffect(()=>{l&&L()},[l]);const L=async()=>{try{const t=await k.get(`/api/v1/products/${l}/reviews`);R(t.data.reviews||[]),t.data.stats&&_(t.data.stats)}catch(t){console.error("Failed to fetch reviews:",t)}finally{u(!1)}},F=async t=>{var r,a;if(t.preventDefault(),!v.trim()){N({type:"error",message:"Please write a review"});return}g(!0);try{await k.post(`/api/v1/products/${l}/reviews`,{rating:y,comment:v}),N({type:"success",message:"Review submitted!"}),n(!1),M(""),S(5),L()}catch(i){N({type:"error",message:((a=(r=i.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to submit review"})}finally{g(!1)}},s=(t,r=!1,a=null)=>Array.from({length:5}).map((i,m)=>e.jsx("button",{type:"button",onClick:()=>r&&a&&a(m+1),className:`text-xl ${m<t?"text-yellow-400":"text-gray-300"} ${r?"cursor-pointer hover:scale-110 transition-transform":""}`,disabled:!r,children:"â˜…"},m)),b=t=>new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),C=o.some(t=>t.user_id===(f==null?void 0:f.id));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"card",children:[e.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Customer Reviews"}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-gray-900",children:((w=d.average)==null?void 0:w.toFixed(1))||"0.0"}),e.jsx("div",{className:"flex justify-center my-1",children:s(Math.round(d.average||0))}),e.jsxs("div",{className:"text-sm text-gray-500",children:[d.total||0," reviews"]})]}),e.jsx("div",{className:"flex-1 space-y-1",children:[5,4,3,2,1].map(t=>{var i;const r=((i=d.distribution)==null?void 0:i[t])||0,a=d.total?r/d.total*100:0;return e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"w-3 text-gray-600",children:t}),e.jsx("span",{className:"text-yellow-400",children:"â˜…"}),e.jsx("div",{className:"flex-1 h-2 bg-gray-200 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-yellow-400 rounded-full",style:{width:`${a}%`}})}),e.jsx("span",{className:"w-8 text-gray-500 text-xs",children:r})]},t)})})]})]}),P&&h&&!C&&e.jsx("div",{className:"card",children:j?e.jsxs("form",{onSubmit:F,className:"space-y-4",children:[e.jsx("h4",{className:"font-medium text-gray-900",children:"Write Your Review"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Your Rating"}),e.jsx("div",{className:"flex gap-1",children:s(y,!0,S)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-2",children:"Your Review"}),e.jsx("textarea",{value:v,onChange:t=>M(t.target.value),placeholder:"Share your experience with this product...",className:"input min-h-[100px] resize-none",required:!0})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>n(!1),className:"btn-secondary flex-1",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:p,className:"btn-primary flex-1 disabled:opacity-50",children:p?"Submitting...":"Submit Review"})]})]}):e.jsx("button",{onClick:()=>n(!0),className:"btn-primary w-full",children:"âœï¸ Write a Review"})}),e.jsx("div",{className:"space-y-4",children:$?Array.from({length:3}).map((t,r)=>e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(x,{className:"w-10 h-10 rounded-full"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(x,{className:"h-4 w-24 mb-2"}),e.jsx(x,{className:"h-4 w-full mb-1"}),e.jsx(x,{className:"h-4 w-3/4"})]})]})},r)):o.length>0?o.map(t=>{var r,a,i,m,B,W;return e.jsx("div",{className:"card",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-100 overflow-hidden flex items-center justify-center text-lg",children:(r=t.user)!=null&&r.profile_photo_url?e.jsx("img",{src:t.user.profile_photo_url,alt:"",className:"w-full h-full object-cover"}):((i=(a=t.user)==null?void 0:a.first_name)==null?void 0:i[0])||"?"}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("span",{className:"font-medium text-gray-900",children:[(m=t.user)==null?void 0:m.first_name," ",(W=(B=t.user)==null?void 0:B.last_name)==null?void 0:W[0],"."]}),e.jsx("span",{className:"text-xs text-gray-400",children:b(t.created_at)})]}),e.jsxs("div",{className:"flex items-center gap-1 mb-2 text-sm",children:[s(t.rating),t.is_verified_purchase&&e.jsx("span",{className:"ml-2 text-xs px-2 py-0.5 bg-green-100 text-green-600 rounded-full",children:"Verified Purchase"})]}),e.jsx("p",{className:"text-gray-600 text-sm",children:t.comment})]})]})},t.id)}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("span",{className:"text-4xl block mb-2",children:"â­"}),e.jsx("p",{className:"text-gray-500",children:"No reviews yet. Be the first to review this product!"})]})})]})}function J(){var C,w,t,r;const{id:l}=D(),h=E(),{currentProduct:o,fetchProduct:R,isLoading:$}=I(),{isAuthenticated:u,user:j}=z(),{addToast:n}=A(),[y,S]=c.useState(0),[v,M]=c.useState(1),[p,g]=c.useState(!1),[d,_]=c.useState(!1),[P,f]=c.useState(!1);c.useEffect(()=>{R(l)},[l]),c.useEffect(()=>{u&&l&&k.get(`/api/v1/wishlist/check/${l}`).then(a=>g(a.data.is_saved)).catch(()=>{})},[u,l]);const N=async()=>{var a,i;if(!u){n({type:"info",message:"Please login to save items"}),h("/login");return}_(!0);try{p?(await k.delete(`/api/v1/wishlist/${l}`),g(!1),n({type:"success",message:"Removed from saved items"})):(await k.post("/api/v1/wishlist",{product_id:parseInt(l)}),g(!0),n({type:"success",message:"Saved to wishlist!"}))}catch(m){n({type:"error",message:((i=(a=m.response)==null?void 0:a.data)==null?void 0:i.message)||"Failed to update wishlist"})}finally{_(!1)}},L=()=>{if(!u){n({type:"info",message:"Please login to make a purchase"}),h("/login");return}h(`/order/new?product=${l}&qty=${v}`)},F=()=>{var a;if(!u){n({type:"info",message:"Please login to contact seller"}),h("/login");return}h(`/chat?seller=${(a=o==null?void 0:o.store)==null?void 0:a.owner_id}&product=${l}`)};if($||!o)return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(q,{showBack:!0}),e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(x,{className:"aspect-square rounded-2xl"}),e.jsx(x,{className:"h-8 w-3/4"}),e.jsx(x,{className:"h-6 w-1/3"}),e.jsx(x,{className:"h-20 w-full"})]})]});const s=o,b=(j==null?void 0:j.id)===((C=s.store)==null?void 0:C.owner_id);return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-24",children:[e.jsx(q,{showBack:!0,transparent:!0,rightElement:!b&&e.jsx("button",{onClick:()=>f(!0),className:"p-2 text-gray-600 hover:text-red-500 transition-colors",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})})}),e.jsx(T,{isOpen:P,onClose:()=>f(!1),entityType:"product",entityId:l}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"aspect-square bg-white",children:s.media&&s.media.length>0?e.jsx("img",{src:(w=s.media[y])==null?void 0:w.url,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 flex items-center justify-center",children:e.jsx("span",{className:"text-8xl opacity-50",children:"ðŸ“¦"})})}),s.compare_price&&s.compare_price>s.price&&e.jsxs("div",{className:"absolute top-20 left-4 bg-red-500 text-white text-sm font-bold px-3 py-1 rounded-lg",children:[Math.round((1-s.price/s.compare_price)*100),"% OFF"]}),s.media&&s.media.length>1&&e.jsx("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-2",children:s.media.map((a,i)=>e.jsx("button",{onClick:()=>S(i),className:`w-12 h-12 rounded-lg overflow-hidden border-2 transition-all ${y===i?"border-primary-500 scale-110":"border-white/50"}`,children:e.jsx("img",{src:a.url,alt:"",className:"w-full h-full object-cover"})},i))})]}),e.jsxs("div",{className:"bg-white -mt-4 rounded-t-3xl relative z-10 px-4 py-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold text-gray-900 mb-2",children:s.title}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-2xl font-bold text-primary-600",children:["â‚¦",s.price.toLocaleString()]}),s.compare_price&&s.compare_price>s.price&&e.jsxs("span",{className:"text-lg text-gray-400 line-through",children:["â‚¦",s.compare_price.toLocaleString()]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-yellow-400",children:"â­"}),e.jsx("span",{className:"font-medium",children:((t=s.rating)==null?void 0:t.toFixed(1))||"0.0"}),e.jsxs("span",{className:"text-gray-400",children:["(",s.total_reviews," reviews)"]})]}),e.jsx("span",{className:"text-gray-300",children:"â€¢"}),e.jsxs("span",{className:"text-gray-500",children:[s.total_orders," sold"]})]}),s.store&&e.jsxs(O,{to:`/store/${s.store.id}`,className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary-100 to-accent-100 flex items-center justify-center overflow-hidden",children:s.store.logo_url?e.jsx("img",{src:s.store.logo_url,alt:s.store.name,className:"w-full h-full object-cover"}):e.jsx("span",{className:"text-xl",children:"ðŸª"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium text-gray-900",children:s.store.name}),e.jsxs("p",{className:"text-sm text-gray-500 flex items-center gap-1",children:[e.jsx("span",{className:"text-yellow-400",children:"â­"}),((r=s.store.rating)==null?void 0:r.toFixed(1))||"0.0",e.jsx("span",{className:"mx-1",children:"â€¢"}),s.store.total_products||0," products"]})]}),e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Description"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:s.description||"No description provided."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Availability"}),e.jsx("p",{className:`font-medium ${s.is_in_stock?"text-green-600":"text-red-600"}`,children:s.is_in_stock?`In Stock (${s.stock_quantity})`:"Out of Stock"})]}),s.pickup_location&&e.jsxs("div",{className:"p-3 bg-gray-50 rounded-xl",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Pickup Location"}),e.jsx("p",{className:"font-medium text-gray-900 truncate",children:s.pickup_location})]})]}),s.categories&&s.categories.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:s.categories.map(a=>e.jsx(O,{to:`/category/${a.slug}`,className:"px-3 py-1 bg-gray-100 rounded-full text-sm text-gray-600 hover:bg-primary-50 hover:text-primary-600",children:a.name},a.id))})]}),e.jsx("div",{className:"px-4 py-6",children:e.jsx(U,{productId:l,canReview:!b})}),!b&&e.jsxs("div",{className:"fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 px-4 py-3 flex items-center gap-3 z-50",children:[e.jsx("button",{onClick:N,disabled:d,className:`p-3 rounded-xl border-2 transition-all ${p?"bg-red-50 border-red-200 text-red-500":"border-gray-200 text-gray-400 hover:text-red-400 hover:border-red-200"}`,title:p?"Remove from saved":"Save item",children:e.jsx("svg",{className:"w-5 h-5",fill:p?"currentColor":"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"})})}),e.jsxs("button",{onClick:F,className:"btn-secondary flex-1",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"})}),"Contact Seller"]}),e.jsx("button",{onClick:L,disabled:!s.is_in_stock,className:"btn-primary flex-1 disabled:opacity-50 disabled:cursor-not-allowed",children:s.is_in_stock?"Buy Now":"Out of Stock"})]})]})}export{J as default};
